#!/usr/bin/env ruby

require "digest"

# when you copy the src here, make sure you don't change the indentation or start/end spacing.
css = ".turbo-progress-bar {
  position: fixed;
  display: block;
  top: 0;
  left: 0;
  height: 3px;
  background: #0076ff;
  z-index: 2147483647;
  transition:
    width 300ms ease-out,
    opacity 150ms 150ms ease-in;
  transform: translate3d(0, 0, 0);
}
"

puts <<~INSTRUCTIONS
  This script generates a Content Security Policy (CSP) hash for the Turbo ProgressBar CSS.
  The CSS is hardcoded into this script because it is generated by the Turbo JavaScript code.
  You can copy it directly from the <style> tag injected at the top of the <head> on a page with Turbo.
  It's dynamically generated so we can't just copy it from the source code.
  The CSS is generated inside the ProgressBar class, example link here:

  https://github.com/hotwired/turbo-rails/blob/b733dfc3d08b6c64be68b6699250cf402e1cd631/app/assets/javascripts/turbo.js#L2306

  Once updated, add this to config/initializers/content_security_policy.rb in the style-src directive:

  policy.style_src :self, ..., "'sha256-#{Digest::SHA256.base64digest(css)}'"
INSTRUCTIONS

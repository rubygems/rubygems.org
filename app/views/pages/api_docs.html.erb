<% @title = "API Docs" %>
<% @subtitle = "get your code on" %>
<p>
  <%= t('.wip_header', :help_link => link_to(t('.help_link_text'), "http://github.com/rubygems/gemcutter"),
                       :gemcutter_gem_link => link_to(t('.gemcutter_gem_link_text'), rubygem_url('gemcutter')),
                       :gem_docs_link => link_to(t('.gem_docs_link_text'), page_url('gem_docs'))).html_safe %>
</p>

<h4><%= t '.sections.header' %></h4>
<ul id="docs">
  <% %w(gem gemversion gemversiondownloads owner webhook misc).each do |section| %>
    <li><%= link_to t(".sections.#{section}"), "##{section}" %>: <%= t ".sections.#{section}_info" %></li>
  <% end %>
</ul>

<h4 id="gem"><%= t '.sections.gem' %></h4>

<h5 class="api">GET - /api/v1/gems/[name].(json|xml)</h5>
<p>
<%= t '.gem.show' %>
<pre><code>$ curl <%=t :url %>/api/v1/gems/rails.json

{
  "name": "rails",
  "info": "Rails is a framework for building web-application using CGI, FCGI, mod_ruby,
           or WEBrick on top of either MySQL, PostgreSQL, SQLite, DB2, SQL Server, or 
           Oracle with eRuby- or Builder-based templates.",
  "version": "2.3.5",
  "version_downloads": 2451,
  "authors": "David Heinemeier Hansson",
  "downloads": 134451,
  "project_uri": "<%=t :url %>/gems/rails",
  "gem_uri": "<%=t :url %>/gems/rails-2.3.5.gem",
  "homepage_uri": "http://www.rubyonrails.org/",
  "wiki_uri": "http://wiki.rubyonrails.org/",
  "documentation_uri": "http://api.rubyonrails.org/",
  "mailing_list_uri": "http://groups.google.com/group/rubyonrails-talk",
  "source_code_uri": "http://github.com/rails/rails",
  "bug_tracker_uri": "http://rails.lighthouseapp.com/projects/8994-ruby-on-rails",
  "dependencies": {
    "runtime": [
      {
        "name": "activesupport",
        "requirements": ">= 2.3.5"
      }
    ],
    "development": [ ]
  }
}

$ curl <%=t :url %>/api/v1/gems/rails.xml

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;rubygem&gt;
  &lt;downloads type="integer"&gt;223423&lt;/downloads&gt;
  &lt;name&gt;rails&lt;/name&gt;
  &lt;info&gt;
    Rails is a framework for building web-application using CGI, FCGI, mod_ruby, or WEBrick
    on top of either MySQL, PostgreSQL, SQLite, DB2, SQL Server, or Oracle with eRuby- or Builder-based templates.
  &lt;/info&gt;
  &lt;gem-uri&gt;<%=t :url %>/gems/rails-2.3.5.gem&lt;/gem-uri&gt;
  &lt;project-uri&gt;<%=t :url %>/gems/rails&lt;/project-uri&gt;
  &lt;version&gt;2.3.5&lt;/version&gt;
  &lt;authors&gt;David Heinemeier Hansson&lt;/authors&gt;
  &lt;version-downloads type="integer"&gt;141363&lt;/version-downloads&gt;
  &lt;homepage-uri&gt;http://www.rubyonrails.org/&lt;/homepage-uri&gt;
  &lt;wiki-uri&gt;http://wiki.rubyonrails.org/&lt;/wiki-uri&gt;
  &lt;documentation-uri&gt;http://api.rubyonrails.org/&lt;/documentation-uri&gt;
  &lt;mailing-list-uri&gt;http://groups.google.com/group/rubyonrails-talk&lt;/mailing-list-uri&gt;
  &lt;source-code-uri&gt;http://github.com/rails/rails&lt;/source-code-uri&gt;
  &lt;bug-tracker-uri&gt;http://rails.lighthouseapp.com/projects/8994-ruby-on-rails&lt;/bug-tracker-uri&gt;
  &lt;dependencies&gt;
    &lt;development type="array"/&gt;
    &lt;runtime type="array"&gt;
      &lt;dependency&gt;
        &lt;name&gt;activesupport&lt;/name&gt;
        &lt;requirements&gt;&gt;= 2.3.5&lt;/requirements&gt;
      &lt;/dependency&gt;
    &lt;/runtime&gt;
  &lt;/dependencies&gt;
&lt;/rubygem&gt;</code></pre>
</p>

<h5 class="api">GET - /api/v1/search.(json|xml)?query=[YOUR QUERY]</h5>
<p>
<%= t '.gem.search' %>
<pre><code>$ curl '<%=t :url %>/api/v1/search.json?query=cucumber'

$ curl '<%=t :url %>/api/v1/search.xml?query=cucumber'</code></pre>
</p>

<h5 class="api">GET - /api/v1/gems.(json|xml)</h5>
<p>
<%= t '.gem.index' %>
<pre><code>$ curl -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
          <%=t :url %>/api/v1/gems.json</code></pre>
</p>

<h5 class="api">POST - /api/v1/gems</h5>
<p>
<%= t '.gem.create' %>
<pre><code>$ curl --data-binary @gemcutter-0.2.1.gem \
       -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       <%=t :url %>/api/v1/gems

Successfully registered gem: gemcutter (0.2.1)</code></pre>
</p>

<h5 class="api">DELETE - /api/v1/gems/yank</h5>
<p>
<%= t '.gem.delete' %>
<pre><code> $ curl -X DELETE -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
        -d 'gem_name=bills' -d 'version=0.0.1' \
        -d 'platform=x86-darwin-10' \
        <%=t :url %>/api/v1/gems/yank

Successfully yanked gem: bills (0.0.1)</code></pre>
</p>

<h5 class="api">PUT - /api/v1/gems/unyank</h5>
<p>
<%= t '.gem.update' %>
<pre><code> $ curl -X PUT -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
        -d 'gem_name=bills' -d 'version=0.0.1' \
        -d 'platform=x86-darwin-10' \
        <%=t :url %>/api/v1/gems/unyank

Successfully unyanked gem: bills (0.0.1)</code></pre>
</p>

<h4 id="gemversion"><%= t '.sections.gemversion' %></h4>

<h5 class="api">GET - /api/v1/versions/[rubygem name].json</h5>
<p>
<%= t '.gemversion.show' %>
<pre><code>$ curl <%=t :url %>/api/v1/versions/coulda.json

[
   {
      "number" : "0.6.3",
      "built_at" : "2010-12-23T05:00:00Z",
      "summary" : "Test::Unit-based acceptance testing DSL",
      "downloads_count" : 175,
      "platform" : "ruby",
      "authors" : "Evan David Light",
      "description" : "Behaviour Driven Development derived from Cucumber but as an internal DSL with methods for reuse",
      "prerelease" : false,
   }
]

</code></pre>
</p>


<h4 id="gemversiondownloads"><%= t '.sections.gemversiondownloads' %></h4>

<h5 class="api">GET - /api/v1/versions/[rubygem name]-[rubygem version]/downloads.json</h5>
<p>
<%= t '.gemversiondownloads.index' %>
<pre><code>$ curl <%=t :url %>/api/v1/versions/coulda-0.6.3/downloads.json

{
  "2010-11-30":0,
  "2010-12-01":0,
  "2010-12-02":0,
  ...
}

</code></pre>

<h5 class="api">GET - /api/v1/versions/[rubygem name]-[rubygem version]/downloads/search.json?from=[start date str]&to=[end date str]</h5>
<p>
<%= t '.gemversiondownloads.search' %>

<pre><code>$ curl <%=t :url %>/api/v1/versions/coulda-0.6.3/downloads/search.json?from=2011-11-1&to=2011-11-5</h5>

{
  "2011-11-01":0,
  "2011-11-02":0,
  "2011-11-03":0,
  "2011-11-04":0,
  "2011-11-05":0
}

</code></pre>

<h4 id="owner"><%= t '.sections.owner' %></h4>

<h5 class="api">GET - /api/v1/gems/[rubygem name]/owners.json</h5>
<p>
<%= t '.owner.index' %>
<pre><code>$ curl -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       <%=t :url %>/api/v1/gems/gemcutter/owners.json

[
  {
    "email": "nick@gemcutter.org"
  },
  {
    "email": "ddollar@gmail.com"
  }
]
</code></pre>
</p>

<h5 class="api">POST - /api/v1/gems/[rubygem name]/owners</h5>
<p>
<%= t '.owner.create' %>
<pre><code>$ curl -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       -F 'email=josh@technicalpickles.com' \
       <%=t :url %>/api/v1/gems/gemcutter/owners

Owner added successfully.
</code></pre>
</p>

<h5 class="api">DELETE - /api/v1/gems/[rubygem name]/owners</h5>
<p>
<%= t '.owner.delete' %>
<pre><code>$ curl -X DELETE -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
        -d "email=josh@technicalpickles.com" \
        <%=t :url %>/api/v1/gems/gemcutter/owners

Owner removed successfully.
</code></pre>
</p>

<h4 id="webhook"><%= t '.sections.webhook' %></h4>

<h5 class="api">GET - /api/v1/web_hooks.json</h5>
<p>
<%= t '.webhook.index' %>
<pre><code>$ curl -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       <%=t :url %>/api/v1/web_hooks.json

{
  "all gems": [
    {
      "url": "http://gemwhisperer.heroku.com",
      "failure_count": 1
    }
  ]
  "rails": [
    {
      "url": "http://example.com",
      "failure_count": 0
    }
  ]
}
</code></pre>
</p>

<h5 class="api">POST - /api/v1/web_hooks</h5>
<p>
<%= t '.webhook.create' %>
<%= t('.webhook.params', :gem_name => content_tag(:code, 'gem_name'),
                         :url => content_tag(:code, 'url'),
                         :all_gems => content_tag(:code, '*')).html_safe %>
<pre><code>$ curl -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       -F 'gem_name=rails' -F 'url=http://example.com' \
       <%=t :url %>/api/v1/web_hooks

Successfully created webhook for rails to http://example.com

$ curl -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       -F 'gem_name=*' -F 'url=http://example.com' \
       <%=t :url %>/api/v1/web_hooks

Successfully created webhook for all gems to http://example.com</code></pre>
</p>

<h5 class="api">DELETE - /api/v1/web_hooks/remove</h5>
<p>
  <%= t '.webhook.delete' %>
  <%= t('.webhook.params', :gem_name => content_tag(:code, 'gem_name'),
                           :url => content_tag(:code, 'url'),
                           :all_gems => content_tag(:code, '*')).html_safe %>
<pre><code>$ curl -X DELETE -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       -d 'gem_name=rails' -d 'url=http://example.com' \
       <%=t :url %>/api/v1/web_hooks/remove

Successfully removed webhook for rails to http://example.com

$ curl -X DELETE -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       -d 'gem_name=*' -d 'url=http://example.com' \
       <%=t :url %>/api/v1/web_hooks/remove

Successfully removed webhook for all gems to http://example.com</code></pre>
</p>

<h5 class="api">POST - /api/v1/web_hooks/fire</h5>
<p>
<%= t '.webhook.test' %>
<%= t('.webhook.params', :gem_name => content_tag(:code, 'gem_name'),
                         :url => content_tag(:code, 'url'),
                         :all_gems => content_tag(:code, '*')).html_safe %>
</p>
<p>
<%= t '.webhook.authorization' %>
</p>
<p>
<pre><code>$ curl -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       -F 'gem_name=rails' -F 'url=http://example.com' \
       <%=t :url %>/api/v1/web_hooks/fire

Successfully deployed webhook for rails to http://example.com

$ curl -H 'Authorization:701243f217cdf23b1370c7b66b65ca97' \
       -F 'gem_name=*' -F 'url=http://example.com' \
       <%=t :url %>/api/v1/web_hooks/fire

Successfully deployed webhook for all gems to http://example.com</code></pre>
</p>

<h4 id="misc"><%= t '.sections.misc' %></h4>

<h5 class="api">GET - /api/v1/api_key</h5>
<p>
<%= t '.misc.api_key' %>
<pre><code>$ curl -u "nick@gemcutter.org:schwwwwing" \
       <%=t :url %>/api/v1/api_key

701243f217cdf23b1370c7b66b65ca97
</code></pre>
</p>

<h5 class="api">GET - /api/v1/dependencies?gems=[comma delimited rubygems]</h5>
<p>
<%= t '.misc.dependencies' %>
<pre><code>
$ ruby -ropen-uri -rpp -e \
  'pp Marshal.load(open("<%= t :url %>/api/v1/dependencies?gems=rails,thor"))'

[{:platform=>"ruby",
  :dependencies=>
   [["bundler", "~> 1.0"],
    ["railties", "= 3.0.3"],
    ["actionmailer", "= 3.0.3"],
    ["activeresource", "= 3.0.3"],
    ["activerecord", "= 3.0.3"],
    ["actionpack", "= 3.0.3"],
    ["activesupport", "= 3.0.3"]],
  :name=>"rails",
  :number=>"3.0.3"},
...
{:number=>"0.9.9", :platform=>"ruby", :dependencies=>[], :name=>"thor"}]
</code></pre>
</p>

<% @title = @rubygem.name %>
<% @subtitle = @latest_version.try(:slug) %>

<% content_for :head do %>
  <%= auto_discovery_link_tag(:atom, rubygem_versions_path(@rubygem, format: "atom"), {title: "#{@rubygem.name} Version Feed"}) %>
  <% if @rubygem.versions.present? && @latest_version.indexed %>
    <link rel="canonical" href="<%= rubygem_version_url(@rubygem, @latest_version.slug) %>" />
  <% else %>
    <meta name="robots" content="noindex" />
  <% end %>
<% end %>

<% if @rubygem.versions.count.zero? %>
  <div class="t-body">
    <p><%= t '.not_hosted_notice' %></p>
  </div>
<% else %>
  <div class="l-overflow">
    <div class="l-colspan--l colspan--l--has-border">
      <% if @latest_version.indexed %>
        <div class="gem__intro">
          <div id="markup" class="gem__desc">
            <%= simple_markup(@latest_version.info) %>
          </div>
        </div>
      <% else %>
        <div class="t-body">
          <p><%=t '.yanked_notice' %></p>
        </div>
      <% end %>

      <% if @versions.present? %>
        <div class="l-half--l">
          <div class="versions">
            <h3 class="t-list__heading"><%= t '.versions_header' %>:</h3>
            <ol class="gem__versions t-list__items">
              <%= render @versions %>
            </ol>
            <% if show_all_versions_link?(@rubygem) %>
              <%= link_to t('.show_all_versions', :count => @rubygem.versions.count), rubygem_versions_url(@rubygem), :class => "gem__see-all-versions t-link--gray t-link--has-arrow" %>
            <% end %>
          </div>
        </div>
      <% end %>

      <%= render :partial => "rubygems/dependencies", :locals => { :dependencies => @latest_version.dependencies.runtime } %>
      <%= render :partial => "rubygems/dependencies", :locals => { :dependencies => @latest_version.dependencies.development } %>

      <% if @latest_version.requirements.present? %>
        <div class="l-half--l">
          <h3 class="t-list__heading"><%= t '.requirements_header' %>:</h3>
          <div class="t-list__items">
            <% Array(@latest_version.requirements).each do |requirement| %>
              <p><%= requirement %></p>
            <% end %>
          </div>
        </div>
      <% end %>

      <div class="gem__members">
        <% if @latest_version.indexed %>
          <% if @latest_version.authors.present? %>
            <h3 class="t-list__heading"><%= t '.authors_header' %>:</h3>
            <ul class="t-list__items">
              <li class="t-list__item">
                <p><%= @latest_version.authors %></p>
              </li>
            </ul>
          <% end %>

          <% if @rubygem.owners.present? %>
            <h3 class="t-list__heading"><%= t '.owners_header' %>:</h3>
            <div class="gem__owners">
              <%= links_to_owners(@rubygem) %>
            </div>
          <% end %>

          <% if @latest_version.sha256.present? %>
            <h3 class="t-list__heading"><%= t '.sha_256_checksum' %>:</h3>
            <div class="gem__sha">
              <%= @latest_version.sha256_hex %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>

    <%= render "rubygems/aside" %>
  </div>
<% end %>

<% content_for :javascript do %>
  <script>
    var gemfileCopyButton = document.getElementById("js-gem__code--gemfile");
    var installCopyButton = document.getElementById("js-gem__code--install");

    var client   = new ZeroClipboard( gemfileCopyButton );
    var client2  = new ZeroClipboard( installCopyButton );

    client.on("error", function() {
      client.destroy();
      gemfileCopyButton.style.display = "none";
    });

    client2.on("error", function() {
      client2.destroy();
      installCopyButton.style.display = "none";
    });
  </script>
<% end %>
